/**
 * GET /examples/mongoose/01schematypes-buffer
 *
 * *** Buffer schema type
 */
require('rootpath')();
var SchematypesBufferModel = require('server/app/models/examples/schematypesBuffer');
var errorsLib = require('server/app/lib/errorsLib');


var fs = require('fs');


module.exports = function (req, res, next) {
    'use strict';
    console.log(__dirname);

    var buffImg = fs.readFileSync(__dirname + '/01schematypes-buffer.png');

    var docInput = {
        buff: buffImg
    };

    //insert doc
    SchematypesBufferModel.saveDocAsync(docInput)
        .then(data => {
            //show buffer array in concole (too long)
            console.log(JSON.stringify(data, null, 2));
            // res.send(JSON.stringify(data, null, 2)).end();

            //show image in browser
            res.contentType('image/png');
            res.send(data.buff);
        })
        .catch(err => {
            err.status = err.status || 500;
            errorsLib.onErrorCatch(err, res);
        });

};


/*
MONGO:
{
"_id": "5783ad60e62e06202e74f560" }
"__v": 0,
"updated_at": "2016-07-11T14:29:52.800Z",
"created_at": "2016-07-11T14:29:52.800Z",
"buff": { "type": "Buffer", "data": [ 137, 80, 78, 71, 13, 10, 26, 10, 0, 0, 0, 13, 73, 72, 68, 82, 0, 0, 0, 32, 0, 0, 0, 32, 8, 3, 0, 0, 0, 68, 164, 138, 198, 0, 0, 0, 174, 80, 76, 84, 69, 255, 255, 255, 223, 152, 56, 178, 122, 45, 250, 250, 250, 168, 126, 84, 229, 166, 84, 218, 148, 55, 221, 151, 56, 167, 114, 42, 191, 130, 48, 92, 56, 26, 134, 99, 74, 246, 246, 246, 210, 144, 55, 215, 147, 55, 121, 100, 83, 141, 107, 80, 238, 237, 236, 206, 199, 194, 175, 120, 50, 130, 90, 44, 185, 128, 52, 127, 107, 90, 94, 57, 27, 140, 93, 40, 201, 138, 54, 233, 158, 57, 159, 110, 49, 31, 29, 32, 153, 139, 127, 85, 52, 23, 167, 136, 102, 169, 125, 68, 101, 75, 52, 169, 154, 139, 125, 80, 36, 211, 206, 202, 84, 54, 28, 144, 128, 116, 161, 110, 43, 126, 83, 35, 78, 46, 21, 135, 89, 39, 125, 92, 67, 137, 116, 101, 114, 83, 57, 109, 77, 51, 118, 84, 56, 153, 113, 77, 122, 95, 74, 162, 147, 137, 116, 88, 67, 110, 69, 32, 0, 0, 0, 91, 62, 36, 158, 115, 71, 210, 156, 89, 229, 161, 69, 126, 81, 207, 7, 0, 0, 1, 150, 73, 68, 65, 84, 56, 141, 173, 147, 219, 118, 130, 48, 16, 69, 73, 41, 96, 2, 4, 21, 185, 169, 196, 59, 136, 40, 136, 90, 212, 255, 255, 177, 78, 192, 80, 196, 250, 210, 213, 243, 66, 50, 103, 51, 153, 76, 18, 73, 250, 95, 201, 178, 97, 200, 242, 91, 119, 189, 12, 247, 110, 177, 15, 151, 235, 95, 153, 97, 84, 20, 186, 222, 239, 235, 122, 81, 68, 195, 23, 123, 112, 58, 167, 220, 230, 210, 245, 244, 124, 26, 116, 252, 253, 143, 95, 19, 251, 193, 179, 127, 72, 83, 32, 132, 96, 114, 120, 34, 194, 44, 207, 211, 227, 103, 163, 99, 154, 231, 89, 216, 170, 175, 204, 242, 235, 77, 105, 233, 118, 205, 179, 178, 169, 212, 112, 179, 108, 174, 220, 81, 75, 119, 101, 158, 101, 174, 209, 36, 40, 71, 10, 234, 72, 25, 149, 77, 138, 144, 120, 118, 215, 71, 200, 246, 200, 163, 10, 217, 34, 151, 0, 33, 220, 195, 194, 171, 134, 193, 133, 88, 117, 71, 229, 69, 5, 244, 190, 122, 72, 83, 41, 85, 181, 106, 200, 129, 69, 13, 24, 37, 185, 96, 149, 255, 70, 193, 6, 132, 242, 12, 42, 190, 144, 210, 16, 128, 23, 155, 26, 210, 76, 21, 161, 241, 24, 33, 181, 154, 196, 158, 0, 96, 9, 178, 114, 76, 10, 97, 68, 29, 135, 34, 112, 169, 233, 172, 136, 88, 66, 182, 24, 241, 124, 39, 0, 127, 60, 153, 78, 39, 144, 67, 11, 28, 223, 35, 236, 81, 164, 20, 2, 64, 118, 38, 175, 223, 140, 227, 250, 187, 131, 16, 19, 205, 30, 110, 24, 97, 91, 90, 237, 144, 215, 0, 162, 91, 8, 109, 68, 163, 12, 88, 131, 249, 106, 187, 75, 170, 15, 33, 75, 180, 90, 26, 38, 44, 241, 105, 27, 160, 62, 132, 90, 215, 42, 98, 201, 42, 254, 104, 41, 94, 37, 44, 106, 95, 24, 43, 33, 54, 223, 102, 45, 205, 180, 73, 98, 61, 95, 41, 43, 217, 98, 65, 104, 38, 222, 118, 124, 32, 162, 141, 143, 3, 56, 8, 56, 142, 0, 251, 155, 168, 227, 243, 74, 221, 145, 237, 224, 32, 192, 142, 61, 114, 95, 175, 189, 84, 61, 156, 217, 124, 18, 207, 103, 111, 30, 78, 197, 24, 160, 183, 238, 31, 245, 13, 170, 196, 40, 50, 26, 99, 172, 127, 0, 0, 0, 0, 73, 69, 78, 68, 174, 66, 96, 130 ] },
 */
